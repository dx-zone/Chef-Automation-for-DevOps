**Chef: Keywords and Vocabulary**



**References**

https://docs.chef.io/platform_overview/

https://docs.chef.io/ohai/

https://www.devopsschool.com/tutorial/chef/chef-attributes.html

https://docs.chef.io/attribute_precedence/



This is a very vague and simple way for me to describe at a very high level what 



**Chef Infra** - the Chef server which is the hub that stores cookbooks, run_list, nodes, etc. Chef automation works in a client-server model and the Chef Infra is the server portion.

**Chef Infra Client** -is the Chef client portion that is installed on the node or servers that are going to be managed by Chef Infra server. The servers that are going to be managed are called clients, and the Chef client ( the chef-client software) needs to be install on these servers to bootstrap the node with the Chef server.

**Chef Manage** - Is the web UI that is used to manage the Chef cookbooks, nodes, roles, run_list, policies, users, Starter Kit, etc.

**Hosted Chef** - is a cloud based Chef where Chef server is hosted by the Chef developers (https://manage.chef.io). It's free up to 25 nodes and is ideal to get started with Chef and start learning right away.

**Chef Workstation (formerly known as ChefDK)** - is a collection of tools that get installed on a laptop or PC or even a server to work with and generate cookbooks, create recipes, attribute files, roles, data_bags, to manage Chef nodes, etc.

**Chef Repo** - is a directory used to store a collection of cookbooks and recipes.

**Recipe** - a file or a collection of files that describes what's needs to be done to a node or a group of nodes (devices we want to manage remotely) and these can be grouped in what is called a cookbook.

**Cookbook** - is a directory that can contain a single recipe or a collection of recipes, roles, attributes, data_bag, templates, etc. that can be run against a node and that are usually stored in a particular folder within a chef-repo directory. These are usually generated by someone using the Chef Workstation tools, in a local chef-repo directory and then pushed/uploaded to the Chef Manage (hosted Chef) or to the Chef Infra server. When a cookbook is run against a node, the instructions in the recipe are execute to do something to the node and the attributes contained in all attribute files are evaluated in the context of the node object.

**Attribute**
Key-value pair which represents a specific detail about a node.

**Attribute file** - a file located in the attributes/ sub-directory for a cookbook to define hard coded attributes values

**Ohai** - is a tool that is used to collect system configuration data called automatic attributes, similar to Ansible facts. In simple words, is a collection of values gathered from the node like OS, platform, IP, hostname, etc. Ohai is executed everytime chef-client runs and it provides these attributes to Chef Infra Client to be used in cookbooks and to be passed to Chef Infra Server. The types of attributes Ohai collects include but are not limited to: OS, Network, Memory, Disk, CPU, Kernel, Hostnames, FQDN, Virtualization, Cloud provider metadata, etc.



**Where these chef-client attribute values come from?**

1. Nodes (collected by Ohai at the start of each chef-client run)
2. Attribute files (defined in cookbooks)
3. Recipes (defined in cookbooks)
4. Environments
5. Roles



Find automatic attributes collected by Ohai

```bash
find  /opt/chefdk/embedded/lib/ruby/gems/*/gems/ohai-*/lib -name "*.rb" -print | xargs grep -R "provides" -h |sed 's/^\s*//g'|sed "s/\\\"/\'/g"|sort|uniq|grep "\sprovides"

# or

find /opt/chef-workstation/embedded/lib/ruby/gems/3.0.0/gems/ohai-17.9.0/lib/ -name "*.rb" -print | xargs grep -R "provides" -h |sed 's/^\s*//g'|sed "s/\\\"/\'/g"|sort|uniq|grep "\sprovides"
```



Run Ohai manually to collect attributes. This will print the attributes to the screen in JSON format.

```bash
ohai
```



Default attributes defined in the default.rb attribute file:
./chef-repo/cookbooks/apache2/attributes/default.rb

```ruby
# Default attributes set in an attribute file
default['apache']['dir'] = '/etc/apache2'
default['apache']['listen_ports'] = [ '80','443' ]
```



Node methods used to set attribute values on a node:
./chef-repo/cookbooks/apache2/attributes/default.rb

```ruby
# Node method to set attributes in an attribute file
node.default['apache']['dir'] = '/etc/apache2'
node.default['apache']['listen_ports'] = [ '80','443' ] 
```



Normal attribute set as a cookbook attribute:
./chef-repo/cookbooks/apache2/attributes/default.rb

```ruby
# Set a normal attribute in an attribute file
set['apache']['dir'] = '/etc/apache2'
normal['apache']['dir'] = '/etc/apache2'  #set is an alias of normal.
```



Override attribute defined in the default.rb attribute file:
./chef-repo/cookbooks/apache2/attributes/default.rb

```ruby
# Override an attribute in an attribute file
override['apache']['dir'] = '/etc/apache2'
```



Attributes in a recipe file:
./chef-repo/cookbooks/my_cookbook/recipes/default.rb

```ruby
# Default attribute in a node object from a recipe
node.default['apache']['dir'] = '/etc/apache2'

# Normal attribute set in a node object from a recipe
node.normal['apache']['dir'] = '/etc/apache2'

# Override an attribute in a node object from a recipe
node.override['apache']['dir'] = '/etc/apache2'

```

